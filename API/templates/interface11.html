<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prediction Model Tester</title>
    <script>
        function validateInputs() {
            let isValid = true;
            document.querySelectorAll("input[type='number']").forEach(input => {
                const min = parseFloat(input.getAttribute("min"));
                const max = parseFloat(input.getAttribute("max"));
                const value = parseFloat(input.value);

                if (!isNaN(value) && (value < min || value > max)) {
                    alert(`Please fill a value in the bounds for ${input.name} (Min: ${min}, Max: ${max})`);
                    isValid = false;
                }
            });
            return isValid;
        }

        function submitForm() {
            if (!validateInputs()) return;  // Arrête l'envoi si invalide

            const formData = new FormData(document.getElementById("prediction-form"));
            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });

            fetch('/predict/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('prediction_result').innerText = "Prediction: " + data.prediction;
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        }

        function loadBounds() {
            fetch('/get_bounds/')
            .then(response => response.json())
            .then(bounds => {
                Object.keys(bounds).forEach(field => {
                    const input = document.getElementById(field);
                    const label = document.getElementById(field + "_bounds");

                    if (input && bounds[field]) {
                        input.setAttribute("min", bounds[field].min);
                        input.setAttribute("max", bounds[field].max);
                        label.innerText = `(Min: ${bounds[field].min}, Max: ${bounds[field].max})`;

                        // Add onfocus event to show bounds message
                        input.onfocus = () => {
                            alert(`Please fill a value in the bounds for ${field} (Min: ${bounds[field].min}, Max: ${bounds[field].max})`);
                        };

                        // Add oninput event to validate in real-time
                        input.oninput = () => {
                            const value = parseFloat(input.value);
                            if (!isNaN(value) && (value < bounds[field].min || value > bounds[field].max)) {
                                input.setCustomValidity(`Value must be between ${bounds[field].min} and ${bounds[field].max}`);
                            } else {
                                input.setCustomValidity('');
                            }
                        };
                    }
                });
            })
            .catch(error => {
                console.error("Error fetching bounds:", error);
            });
        }

        window.onload = loadBounds;
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }
        h1 {
            color: #333;
        }
        h2 {
            color: #555;
        }
        form {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }
        .field-container {
            display: flex;
            flex-direction: column;
        }
        label {
            font-weight: bold;
        }
        .bounds {
            font-size: 0.9em;
            color: #777;
        }
        input, select, button {
            padding: 8px;
            margin-top: 5px;
            width: 100%;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>

    <h1>Prediction model tester</h1>
    <form id="prediction-form" onsubmit="event.preventDefault(); submitForm();">
        <h2>Fill datas in the form :</h2>

        <!-- Sélectionner le modèle -->
        <div>
            <label for="model_selection">Choose a model :</label>
            <select id="model_selection" name="model_selection" required>
                <option value="extra_trees">Extra Trees</option>
                <option value="gradient_boosting">Gradient Boosting</option>
            </select>
        </div>

        <!-- Colonnes avec <= 5 valeurs uniques -->
        <div>
            <label for="MSZoning">MSZoning:</label>
            <select id="MSZoning" name="MSZoning">
                <option value="">NA</option>
                <option value="RL">RL</option>
                <option value="RM">RM</option>
                <option value="C (all)">C (all)</option>
                <option value="FV">FV</option>
                <option value="RH">RH</option>
            </select>
        </div>
        <div>
            <label for="Street">Street:</label>
            <select id="Street" name="Street">
                <option value="">NA</option>
                <option value="Pave">Pave</option>
                <option value="Grvl">Grvl</option>
            </select>
        </div>
        <div>
            <label for="Alley">Alley:</label>
            <select id="Alley" name="Alley">
                <option value="">NA</option>
                <option value="Grvl">Grvl</option>
                <option value="Pave">Pave</option>
            </select>
        </div>
        <div>
            <label for="LotShape">LotShape:</label>
            <select id="LotShape" name="LotShape">
                <option value="">NA</option>
                <option value="Reg">Reg</option>
                <option value="IR1">IR1</option>
                <option value="IR2">IR2</option>
                <option value="IR3">IR3</option>
            </select>
        </div>
        <div>
            <label for="LandContour">LandContour:</label>
            <select id="LandContour" name="LandContour">
                <option value="">NA</option>
                <option value="Lvl">Lvl</option>
                <option value="Bnk">Bnk</option>
                <option value="Low">Low</option>
                <option value="HLS">HLS</option>
            </select>
        </div>
        <div>
            <label for="Utilities">Utilities:</label>
            <select id="Utilities" name="Utilities">
                <option value="">NA</option>
                <option value="AllPub">AllPub</option>
                <option value="NoSeWa">NoSeWa</option>
            </select>
        </div>
        <div>
            <label for="LotConfig">LotConfig:</label>
            <select id="LotConfig" name="LotConfig">
                <option value="">NA</option>
                <option value="Inside">Inside</option>
                <option value="FR2">FR2</option>
                <option value="Corner">Corner</option>
                <option value="CulDSac">CulDSac</option>
                <option value="FR3">FR3</option>
            </select>
        </div>
        <div>
            <label for="LandSlope">LandSlope:</label>
            <select id="LandSlope" name="LandSlope">
                <option value="">NA</option>
                <option value="Gtl">Gtl</option>
                <option value="Mod">Mod</option>
                <option value="Sev">Sev</option>
            </select>
        </div>
        <div>
            <label for="BldgType">BldgType:</label>
            <select id="BldgType" name="BldgType">
                <option value="">NA</option>
                <option value="1Fam">1Fam</option>
                <option value="2fmCon">2fmCon</option>
                <option value="Duplex">Duplex</option>
                <option value="TwnhsE">TwnhsE</option>
                <option value="Twnhs">Twnhs</option>
            </select>
        </div>
        <div>
            <label for="MasVnrType">MasVnrType:</label>
            <select id="MasVnrType" name="MasVnrType">
                <option value="">NA</option>
                <option value="BrkFace">BrkFace</option>
                <option value="None">None</option>
                <option value="Stone">Stone</option>
                <option value="BrkCmn">BrkCmn</option>
            </select>
        </div>
        <div>
            <label for="ExterQual">ExterQual:</label>
            <select id="ExterQual" name="ExterQual">
                <option value="">NA</option>
                <option value="Gd">Gd</option>
                <option value="TA">TA</option>
                <option value="Ex">Ex</option>
                <option value="Fa">Fa</option>
            </select>
        </div>
        <div>
            <label for="ExterCond">ExterCond:</label>
            <select id="ExterCond" name="ExterCond">
                <option value="">NA</option>
                <option value="TA">TA</option>
                <option value="Gd">Gd</option>
                <option value="Fa">Fa</option>
                <option value="Po">Po</option>
                <option value="Ex">Ex</option>
            </select>
        </div>
        <div>
            <label for="BsmtQual">BsmtQual:</label>
            <select id="BsmtQual" name="BsmtQual">
                <option value="">NA</option>
                <option value="Gd">Gd</option>
                <option value="TA">TA</option>
                <option value="Ex">Ex</option>
                <option value="Fa">Fa</option>
            </select>
        </div>
        <div>
            <label for="BsmtCond">BsmtCond:</label>
            <select id="BsmtCond" name="BsmtCond">
                <option value="">NA</option>
                <option value="TA">TA</option>
                <option value="Gd">Gd</option>
                <option value="Fa">Fa</option>
                <option value="Po">Po</option>
            </select>
        </div>
        <div>
            <label for="BsmtExposure">BsmtExposure:</label>
            <select id="BsmtExposure" name="BsmtExposure">
                <option value="">NA</option>
                <option value="No">No</option>
                <option value="Gd">Gd</option>
                <option value="Mn">Mn</option>
                <option value="Av">Av</option>
            </select>
        </div>
        <div>
            <label for="HeatingQC">HeatingQC:</label>
            <select id="HeatingQC" name="HeatingQC">
                <option value="">NA</option>
                <option value="Ex">Ex</option>
                <option value="Gd">Gd</option>
                <option value="TA">TA</option>
                <option value="Fa">Fa</option>
                <option value="Po">Po</option>
            </select>
        </div>
        <div>
            <label for="CentralAir">CentralAir:</label>
            <select id="CentralAir" name="CentralAir">
                <option value="">NA</option>
                <option value="Y">Y</option>
                <option value="N">N</option>
            </select>
        </div>
        <div>
            <label for="Electrical">Electrical:</label>
            <select id="Electrical" name="Electrical">
                <option value="">NA</option>
                <option value="SBrkr">SBrkr</option>
                <option value="FuseF">FuseF</option>
                <option value="FuseA">FuseA</option>
                <option value="FuseP">FuseP</option>
                <option value="Mix">Mix</option>
            </select>
        </div>

       <!-- New numeric columns -->
        <div class="field-container">
            <label for="LotArea">LotArea:</label>
            <input type="number" id="LotArea" name="LotArea"/>
            <span class="bounds" id="LotArea_bounds"></span>
        </div>

        <div class="field-container">
            <label for="MasVnrArea">MasVnrArea:</label>
            <input type="number" id="MasVnrArea" name="MasVnrArea"/>
            <span class="bounds" id="MasVnrArea_bounds"></span>
        </div>

        <div class="field-container">
            <label for="BsmtFinSF1">BsmtFinSF1:</label>
            <input type="number" id="BsmtFinSF1" name="BsmtFinSF1"/>
            <span class="bounds" id="BsmtFinSF1_bounds"></span>
        </div>

        <div class="field-container">
            <label for="BsmtFinSF2">BsmtFinSF2:</label>
            <input type="number" id="BsmtFinSF2" name="BsmtFinSF2"/>
            <span class="bounds" id="BsmtFinSF2_bounds"></span>
        </div>

        <div class="field-container">
            <label for="BsmtUnfSF">BsmtUnfSF:</label>
            <input type="number" id="BsmtUnfSF" name="BsmtUnfSF"/>
            <span class="bounds" id="BsmtUnfSF_bounds"></span>
        </div>

        <div class="field-container">
            <label for="TotalBsmtSF">TotalBsmtSF:</label>
            <input type="number" id="TotalBsmtSF" name="TotalBsmtSF"/>
            <span class="bounds" id="TotalBsmtSF_bounds"></span>
        </div>

        <div class="field-container">
            <label for="GrLivArea">GrLivArea:</label>
            <input type="number" id="GrLivArea" name="GrLivArea"/>
            <span class="bounds" id="GrLivArea_bounds"></span>
        </div>

        <div class="field-container">
            <label for="GarageArea">GarageArea:</label>
            <input type="number" id="GarageArea" name="GarageArea"/>
            <span class="bounds" id="GarageArea_bounds"></span>
        </div>

        <div class="field-container">
            <label for="WoodDeckSF">WoodDeckSF:</label>
            <input type="number" id="WoodDeckSF" name="WoodDeckSF"/>
            <span class="bounds" id="WoodDeckSF_bounds"></span>
        </div>

        <div class="field-container">
            <label for="OpenPorchSF">OpenPorchSF:</label>
            <input type="number" id="OpenPorchSF" name="OpenPorchSF"/>
            <span class="bounds" id="OpenPorchSF_bounds"></span>
        </div>

        <button type="submit">Predict</button>
    </form>

    <h2 id="prediction_result"></h2>
</body>
</html>